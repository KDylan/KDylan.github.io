<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>iOS 18 and Xcode 16 New Feature - Dylan's Notes</title>

<meta name="description" content="New featureiOS 18 PreviewRelease NoteiOS 18 Release NoteXcode 16 Release NoteAll Technologies UpdatesWhat’s new in UIKitGeneralAutomatic trait trackingLevera...">
<link rel="canonical" href="http://localhost:4000/2024/06/20/iOS_18_Investigation.html"><link rel="alternate" type="application/rss+xml" title="Dylan's Notes" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="24px" height="24px" viewBox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"/>
</svg>
<a title=""Record some study and life notes"
" href="/">Dylan's Notes</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class="article__header--overlay"><div class="hero hero--dark overlay" style="background-image:linear-gradient(135deg, rgba(34, 139, 87 , .4), rgba(139, 34, 139, .4)),url(/assets/images/iOS_18/preview.jpeg);background-color:#203028;"><div class="hero__content"><div class ="main"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=Technology">Technology</a>
            </li></ul><ul class="right-col menu"><li><i class="fas fa-user"></i> <span>Dylan</span></li><li><i class="far fa-calendar-alt"></i> <span>Jun 20, 2024</span>
            </li></ul></div><div class="article__header"><header><h1>iOS 18 and Xcode 16 New Feature</h1></header></div><p class="overlay__excerpt">New featureiOS 18 PreviewRelease NoteiOS 18 Release NoteXcode 16 Release NoteAll Technologies UpdatesWhat’s new in UIKitGeneralAutomatic trait trackingLeverage automatic trait usage tracking inside...</p></div></div>
              </div>
            </div><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><meta itemprop="headline" content="iOS 18 and Xcode 16 New Feature"><meta itemprop="author" content="Dylan"/><meta itemprop="datePublished" content="2024-06-20T00:00:00+08:00">
    <meta itemprop="keywords" content="Technology"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><h1 id="new-feature">New feature</h1>

<h2 id="ios-18-preview"><a href="https://www.apple.com/ios/ios-18-preview/">iOS 18 Preview</a></h2>

<p><img src="/assets/images/iOS_18/home.jpeg" alt="iOS 18 Preview" /></p>

<h1 id="release-note">Release Note</h1>
<h2 id="ios-18-release-note"><a href="https://developer.apple.com/documentation/ios-ipados-release-notes/ios-ipados-18-release-notes">iOS 18 Release Note</a></h2>

<h2 id="xcode-16-release-note"><a href="https://developer.apple.com/documentation/xcode-release-notes/xcode-16-release-notes">Xcode 16 Release Note</a></h2>

<p><img src="/assets/images/iOS_18/xcode_release_note.PNG" alt="" /></p>
<h2 id="all-technologies-updates"><a href="https://developer.apple.com/documentation/updates">All Technologies Updates</a></h2>
<p><br /></p>

<h1 id="whats-new-in-uikit"><a href="https://developer.apple.com/videos/play/wwdc2024/10118/">What’s new in UIKit</a></h1>
<p><a href="https://developer.apple.com/documentation/Updates/UIKit#General">General</a></p>

<h2 id="automatic-trait-tracking"><a href="https://developer.apple.com/documentation/uikit/app_and_environment/automatic_trait_tracking">Automatic trait tracking</a></h2>

<p>Leverage automatic trait usage tracking inside key update methods such as layoutSubviews(), eliminating the need for manual trait change registration and invalidation.</p>

<p align="left">    
<img src="/assets/images/iOS_18/trait_new.PNG" width="330" />
<img src="/assets/images/iOS_18/trait_old.PNG" width="330" />
</p>

<h2 id="list-improvements">List improvements</h2>
<p>Take advantage of enhancements to <code class="language-plaintext highlighter-rouge">UIListContentConfiguration</code>, which now automatically updates to match the style of the containing list by using the new <code class="language-plaintext highlighter-rouge">UIListEnvironment</code> trait from the trait collection, removing the need to instantiate a configuration for a specific list style yourself.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func configurations(for location: FileLocation) -&gt;
    (UIListContentConfiguration, UIBackgroundConfiguration) {

    var contentConfiguration = UIListContentConfiguration.cell()
    let backgroundConfiguration = UIBackgroundConfiguration.listCell()

    contentConfiguration.text = location.title
    contentConfiguration.image = location.thumbnailImage

    return (contentConfiguration, backgroundConfiguration)
 }
</code></pre></div></div>
<p align="left">    
<img src="/assets/images/iOS_18/list_improvements_old.PNG" width="330" />
<img src="/assets/images/iOS_18/list_improvements_new.PNG" width="330" />
</p>

<p align="left">    
<img src="/assets/images/iOS_18/list_improvements_api.png" width="300" />
</p>

<h2 id="uicalendarselectionweekofyear"><a href="https://developer.apple.com/documentation/uikit/uicalendarselectionweekofyear">UICalendarSelectionWeekOfYear</a></h2>
<p>Select a specific week of the year in <code class="language-plaintext highlighter-rouge">UICalendarView</code> using the new <code class="language-plaintext highlighter-rouge">UICalendarSelectionWeekOfYear</code> selection option.</p>

<p>    
<img src="/assets/images/iOS_18/calendarview_demo_view.png" width="120" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Set the selection behavior.
let selection = UICalendarSelectionWeekOfYear(delegate: self)
calendarView.selectionBehavior = selection

// Set the 11th week in the year 2024.
selection.selectedWeekOfYear = DateComponents(
    calendar: Calendar(identifier: .gregorian),
    weekOfYear: 11,
    yearForWeekOfYear: 2024)
    
</code></pre></div></div>

<h2 id="symbol-animations"><a href="https://developer.apple.com/sf-symbols/">Symbol animations</a></h2>
<p>Add repeat, wiggle, breathe, and rotate effects to <a href="https://developer.apple.com/sf-symbols/">SF Symbols</a>.</p>

<p>    
<img src="/assets/images/iOS_18/vedio/symbol.gif" width="300" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VStack{
        Spacer()
        Image(systemName: "arrow.down.circle.fill")
            .resizable()
            .frame(width: 100, height: 100)
            .symbolEffect(.wiggle)
            .symbolRenderingMode(.hierarchical)
                .foregroundColor(.purple)
        Spacer()
        Image(systemName: "figure.skiing.crosscountry.circle.fill")
            .resizable()
            .frame(width: 100, height: 100)
            .symbolEffect(.breathe)
            .symbolRenderingMode(.hierarchical)
                .foregroundColor(.indigo)
        
        Spacer()
        Image(systemName: "figure.skiing.crosscountry.circle.fill")
            .resizable()
            .frame(width: 100, height: 100)
            .symbolEffect(.rotate)
            .symbolRenderingMode(.monochrome)
            .foregroundColor(.indigo)
        Spacer()
    }
</code></pre></div></div>

<p><br /></p>

<h1 id="navigation"><a href="https://developer.apple.com/documentation/Updates/UIKit#Navigation">Navigation</a></h1>

<h2 id="evolve-your-document-launch-experience"><a href="https://developer.apple.com/videos/play/wwdc2024/10132/">Evolve your document launch experience</a></h2>
<p>Showcase your app and its unique identity with a new, customizable launch design for document-based apps. In UIKit, define <code class="language-plaintext highlighter-rouge">launchOptions</code> on your <code class="language-plaintext highlighter-rouge">UIDocumentViewController</code>.</p>
<ul>
  <li>SwiftUl
    <ul>
      <li>Recompile with the iOS 18 SDK</li>
      <li>Add a DocumentGroupLaunchScene</li>
    </ul>
  </li>
  <li>UlKit
    <ul>
      <li>Make UIDocumentViewController the root</li>
      <li>Apply customizations to the launchOptions</li>
    </ul>
  </li>
</ul>

<p>    
<img src="/assets/images/iOS_18/launch_doc_demo.png" width="100" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> // Customize launch options.
    launchOptions.title = "My Text Editor"
    launchOptions.background.backgroundColor = .darkGray
    
    // Provide an action for the secondary action.
    let templateAction = LaunchOptions.createDocumentAction(withIntent: .template)
    templateAction.title = "Choose a Template"
    launchOptions.secondaryAction = templateAction
    // Update the background
    launchOptions.background.image = UIImage(named: "icon")
</code></pre></div></div>

<p><br /></p>

<h2 id="uitab-and-tabsidebar">UITab and TabSidebar</h2>
<p>Make your app’s navigation more immersive by adopting the new tab bar on iPad. If your app presents a rich hierarchy of tab items, set the <code class="language-plaintext highlighter-rouge">mode</code> to <code class="language-plaintext highlighter-rouge">UITabBarController.Mode.tabSidebar</code> to automatically switch between the tab bar and sidebar representations. In SwiftUI, use <code class="language-plaintext highlighter-rouge">sidebarAdaptable</code>.
<img src="/assets/images/iOS_18/tab_api_1.png" alt="" /></p>
<ul>
  <li>
    <p>UITabBarController adds a new label type UITab, which can set title, subtitle, image, badgeValue, etc.</p>
  </li>
  <li>
    <p>UITabBarControllerDelegate adds multiple UITab-related delegate methods.</p>
  </li>
</ul>

<p><img src="/assets/images/iOS_18/tab_api_2.png" alt="" /></p>

<p>Demo</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    tabBarController.mode = .tabSidebar
    // Assign an array of tabs.
    tabBarController.tabs = [
       UITab(title: "First",
             image: UIImage(systemName: "1.circle"),
             identifier: "First Tab") { _ in
                 // Return the view controller that the tab displays.
                 firstHostingController
             },
       UITab(title: "Second",
             image: UIImage(systemName: "2.circle"),
             identifier: "Second Tab") { _ in
                 // Return the view controller that the tab displays.
                 secondHostingController
             },
       UITab(title: "Three",
             image: UIImage(systemName: "3.circle"),
             identifier: "Three Tab") { _ in
                 // Return the view controller that the tab displays.
                 DocumentViewController()
             },
       
    ]
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><code class="language-plaintext highlighter-rouge">iPhone</code></th>
      <th><code class="language-plaintext highlighter-rouge">iPad</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/iOS_18/tab_demo_1.png" alt="Image" title="Image_border" class="border" /></td>
      <td><img src="/assets/images/iOS_18/vedio/UItab.gif" alt="Image" title="Image_shadow" class="shadow" /></td>
    </tr>
  </tbody>
</table>

<h2 id="preferredtransition"><a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/4448100-preferredtransition">PreferredTransition</a></h2>

<p>Transition between views in a way that feels fluid and consistent using a systemwide zoom transition. In UIKit, configure your view controller’s <code class="language-plaintext highlighter-rouge">preferredTransition</code> to <code class="language-plaintext highlighter-rouge">zoom(options:sourceViewProvider:)</code>. In SwiftUI, use <code class="language-plaintext highlighter-rouge">zoom(sourceID:in:)</code>.</p>
<p align="left">    
<img src="/assets/images/iOS_18/prefer_transition_left.png" width="320" />
<img src="/assets/images/iOS_18/prefer_transition_right.png" width="320" />
</p>

<h1 id="framework-interoperability"><a href="https://developer.apple.com/documentation/Updates/UIKit#Framework-interoperability">Framework interoperability</a></h1>
<h2 id="ulkit-and-swiftul-interoperability">UlKit and SwiftUl interoperability</h2>
<p>Use SwiftUI animations from AppKit and UIKit to create a consistent animation experience across apps that use multiple UI frameworks. In UIKit, use <code class="language-plaintext highlighter-rouge">animate(with:changes:completion:)</code>. In AppKit, use <code class="language-plaintext highlighter-rouge">animate(with:changes:completion:)</code>.</p>
<ul>
  <li>Animations</li>
</ul>

<p><img src="/assets/images/iOS_18/uikit_swiftUI_old.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Animate changes to one or more views using the specified SwiftUI animation. Animations performed using this method can be smoothly retargeted while preserving velocity, just like animations in SwiftUI views.
Task {
    // Begins an animation to move the view to a new location.
    UIView.animate(with: .spring(duration: 1.0)) {
        myView.center = CGPoint(x: 200, y: 200)
    }
    try await Task.sleep(for: .seconds(0.5))
    
    // Retargets the running animations to move the view to a different location.
    UIView.animate(with: .spring) {
        myView.center = CGPoint(x: 100, y: 400)
    }
}
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><code class="language-plaintext highlighter-rouge">UIKit</code></th>
      <th><code class="language-plaintext highlighter-rouge">SwiftUI</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/assets/images/iOS_18/vedio/swiftUI_animation_1.gif" alt="Image" title="Image_border" class="border" /></td>
      <td><img src="/assets/images/iOS_18/vedio/swiftUI_animation_2.gif" alt="Image" title="Image_shadow" class="shadow" /></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Gesture recognizers</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>switch gesture.state {
case .changed:
    UIView.animate(.interactiveSpring) {
        bead.center = gesture.translation
    }

case .ended:
    UIView.animate(.spring) {
        bead.center = endOfBracelet
    }
}
</code></pre></div></div>
<h2 id="update-link"><a href="https://developer.apple.com/documentation/uikit/uiupdatelink">Update link</a></h2>
<p>With a UI update link, you can follow the progress of each UI update and express preferences about how those updates happen. Use a UI update link when you need precise and predictable control over the UI update process.
<code class="language-plaintext highlighter-rouge">UIUpdateLink</code> similar to <code class="language-plaintext highlighter-rouge">CADisplayLink</code>
More features</p>
<ul>
  <li>View tracking</li>
  <li>Low latency applications</li>
  <li>Better performance</li>
</ul>

<p>    
<img src="/assets/images/iOS_18/vedio/UIUpdateLink.gif" width="310" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>let updateLink = UIUpdateLink(
    view: view,
    actionTarget: self,
    selector: #selector(update)
)
updateLink.requiresContinuousUpdates = true
updateLink.isEnabled = true

@objc func update(updateLink: UIUpdateLink,
                  updateInfo: UIUpdateInfo) {
    view.center.y = sin(updateInfo.modelTime)
        * 100 + view.bounds.midY
}
</code></pre></div></div>

<h2 id="sensory-feedback"><a href="https://developer.apple.com/documentation/uikit/uicanvasfeedbackgenerator?language=objc%2F">Sensory feedback</a></h2>
<p>Use canvas feedback to indicate when a drawing event occurs, such as an object snapping to a guide or ruler. When using Apple Pencil Pro with a compatible iPad, this type of feedback can provide a tactile response.</p>

<p><img src="/assets/images/iOS_18/sensory_feedback.png" alt="" /></p>

<h2 id="text-improvements">Text improvements</h2>
<p><a href="https://developer.apple.com/videos/play/wwdc2024/10118/?time=7">Using new attributes for highlight</a></p>

<p>    
<img src="/assets/images/iOS_18/text_improvements.png" width="180" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var attributes = [NSAttributedString.Key: Any]()
    // Highlight style
    attributes[.textHighlightStyle] =
    NSAttributedString.TextHighlightStyle.default
    // Highlight color scheme
    attributes[.textHighlightColorScheme] =
    NSAttributedString.TextHighlightColorScheme.purple
</code></pre></div></div>

<p><img src="/assets/images/iOS_18/text_improvements_api.png" alt="" width="670px" height="180px" /></p>

<h2 id="whats-new-in-location-authorization"><a href="https://developer.apple.com/cn/videos/play/wwdc2024/10212/?time=112">What’s new in location authorization</a></h2>
<p>Location Authorization 2.0. Learn new recommendations and tips for getting the authorization you need, and new diagnostics that notify you when you’re not meeting authorization goals.</p>

<p>    
<img src="/assets/images/iOS_18/local_api.png" width="210" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Iterating liveUpdates to reflect current location
Task {
    let updates = CLLocationUpdate.liveUpdates()
    for try await update in updates {
        if let loc = update.location {
            updateLocationUI(location: loc)
        }
    }
}
</code></pre></div></div>
<p><br />
<strong><a href="https://developer.apple.com/documentation/CoreLocation/adopting-live-updates-in-core-location">Download demo code</a></strong></p>

<p><img src="/assets/images/iOS_18/vedio/ScreenRecording_06-19-2024_18-47-40_1.gif" alt="" /></p>

<!-- ![](/assets/images/iOS_18/file/AdoptingLiveUpdatesInCoreLocation.zip) -->

<h2 id="accessorysetupkit"><a href="https://developer.apple.com/videos/play/wwdc2024/10203/">AccessorySetupKit</a></h2>
<p>Elevate your accessory setup experience with AccessorySetupKit. Display a beautiful pairing dialog with an image of your Bluetooth or Wi-Fi accessory — no trip to the Settings app required. Discover how to improve privacy by pairing only your app with an accessory. And learn how you can migrate existing accessories so they can be managed by AccessorySetupKit.</p>

<p><strong><a href="https://developer.apple.com/documentation/AccessorySetupKit/authorizing-a-bluetooth-accessory-to-share-a-dice-roll">Download demo code</a></strong></p>

<p><img src="/assets/images/iOS_18/vedio/ScreenRecording_06-19-2024_18-32-46_1.gif" alt="" />
<!-- ![](/assets/images/iOS_18/file/AuthorizingABluetoothAccessoryToShareADiceRoll.zip) --></p>

<h1 id="whats-new-in-swift">What’s new in Swift<a href="https://developer.apple.com/videos/play/wwdc2024/10136/"></a></h1>
<ul>
  <li><a href="https://developer.apple.com/documentation/updates/swift">Swift updates</a></li>
  <li><a href="https://developer.apple.com/videos/play/wwdc2024/10169/">Migrate your app to Swift 6</a></li>
</ul>

<p><a href="https://developer.apple.com/cn/videos/play/wwdc2024/10170/">Consume noncopyable types in swift</a></p>

<p><img src="/assets/images/iOS_18/swift_new_plan.png" alt="" /></p>

<h2 id="data-race-safety">Data-race safety</h2>
<p>Swift 6 improves concurrency checking further, and the Swift team say it “removes many false-positive data-race warnings” that were present in 5.10. It also introduces several targeted changes that will do wonders to make concurrency easier to adopt</p>

<p>Swift 6 before and now display</p>
<p align="left"> 
<img src="/assets/images/iOS_18/data_race_safe_old.png" width="320" />
<img src="/assets/images/iOS_18/data_race_safe_new.png" width="320" />
</p>

<h2 id="add-collection-operations-on-noncontiguous-elements">Add Collection Operations on Noncontiguous Elements</h2>
<p>Operate on noncontiguous ranges in collections using <code class="language-plaintext highlighter-rouge">RangeSet</code> and <code class="language-plaintext highlighter-rouge">DiscontiguousSlice</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct ExamResult {
    var student: String
    var score: Int
}
// We can get a RangeSet containing the indices of all students who score 85% or higher like this
        let results = [
            ExamResult(student: "Eric Effiong", score: 95),
            ExamResult(student: "Maeve Wiley", score: 70),
            ExamResult(student: "Otis Milburn", score: 100)
        ]
// And if we wanted to get access to those students, we can use a new Collection subscript:
        let topResults = results.indices { student in
            student.score &gt;= 85
        }
       
        for result in results[topResults] {
            print("\(result.student) scored \(result.score)%")
        }
</code></pre></div></div>

<h2 id="access-level-modifiers-on-import-declarations">Access-level modifiers on import declarations</h2>
<p>Adds the ability to mark import declarations with access control modifiers, such as <strong>private import SomeLibrary</strong>.</p>

<h2 id="upgrades-for-noncopyable-types">Upgrades for noncopyable types</h2>
<p>In that code, the compiler enforces that <code class="language-plaintext highlighter-rouge">message.read()</code> can only ever be called once, because it consumes the object.</p>

<p>    
<img src="/assets/images/iOS_18/noncopyable_image.png" width="330" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>struct Message: ~Copyable {
    var agent: String
    private var message: String

    init(agent: String, message: String) {
        self.agent = agent
        self.message = message
    }
    consuming func read() {
        print("\(agent): \(message)")
    }
}
 func createMessage() {
        let message = Message(agent: "Ethan Hunt", message: "You need to abseil down a skyscraper for some reason.")
        message.read()
}
</code></pre></div></div>

<h2 id="typed-throws">Typed throws</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>enum IntegerParseError: Error {
  case nonDigitCharacter(String, index: String.Index)
}

func parse(string: String) throws -&gt; Int {
  for index in string.indices {
    // ...
    throw IntegerParseError.nonDigitCharacter(string, index: index)
  }
}

do {
  let value = try parse(string: "1+234")
}
catch let error as IntegerParseError {
  // ...
}
catch {
   // error is 'any Error'
}

func parse(string: String) throws -&gt; Int {
  //...
}
func parse(string: String) -&gt; Int {
  //...
}
</code></pre></div></div>
<p>Swift 6</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
func parse(string: String) throws(IntegerParseError) -&gt; Int {
  for index in string.indices {
    // ...throw IntegerParseError.nonDigitCharacter(string, index: index)
  }
}

do {
  let value = try parse(string: "1+234")
}
catch {
   // error is 'IntegerParseError'
}

func parse(string: String) throws(any Error) -&gt; Int {
  //...
}

func parse(string: String) throws(Never) -&gt; Int {
  //...
}

</code></pre></div></div>

<h2 id="meet-swift-testing"><a href="https://developer.apple.com/videos/play/wwdc2024/10179/">Meet Swift Testing</a></h2>
<p>Introducing Swift Testing: a new package for testing your code using Swift. Explore the building blocks of its powerful new API, discover how it can be applied in common testing workflows, and learn how it relates to XCTest and open source Swift.</p>

<p align="left"> 
<img src="/assets/images/iOS_18/swift_testing_1.png" width="330" />
<img src="/assets/images/iOS_18/swift_testing_2.png" width="330" />
</p>

<p align="left"> 
<img src="/assets/images/iOS_18/swift_testing_3.png" width="330" />
<img src="/assets/images/iOS_18/swift_testing_4.png" width="330" />
</p>

<h1 id="swift-charts">Swift Charts</h1>
<p>The plot thickens! Learn how to render beautiful charts representing math functions and extensive datasets using function and vectorized plots in your app. Whether you’re looking to display functions common in aerodynamics, magnetism, and higher order field theory, or create large interactive heat maps, Swift Charts has you covered.</p>

<ul>
  <li>Added new plot API variants at iOS 18</li>
</ul>

<p><img src="/assets/images/iOS_18/swift_chart_image.png" alt="" /></p>
<ul>
  <li>Charts demo</li>
</ul>

<p><img src="/assets/images/iOS_18/swift_chart_demo.png" alt="" /></p>
<ul>
  <li>Source Demos</li>
</ul>

<p>    
<img src="/assets/images/iOS_18/swift_chart_source_demo_1.png" width="120" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Chart {
        LinePlot(x: "x", y: "y", t: "t", domain: -.pi ... .pi) {
                t in
                let x = sqrt(2) * pow(sin(t), 3)
                let y = cos(t) * (2 - cos(t) - pow(cos(t), 2))
                return (x, y)
           }
            .foregroundStyle(.red)
            .opacity(0.8)
        }
        .chartXScale(domain: -3 ... 3)
        .chartYScale(domain: -4 ... 2)
</code></pre></div></div>

<p><br /></p>

<p>    
<img src="/assets/images/iOS_18/swift_chart_source_demo_2.png" width="120" align="right" />
</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Chart {
   AreaPlot(x: "x", yStart: "cos(x)", yEnd: "sin(x)") { x in
           (yStart: cos(x / 180 * .pi),
            yEnd: sin(x / 180 * .pi))
        }
            .foregroundStyle(.orange)
            .opacity(0.8)
    }
    .chartXScale(domain: -315 ... 315)
    .chartYScale(domain: -5 ... 5)
</code></pre></div></div>
<p><br /></p>

<h1 id="whats-new-in-swiftdata"><a href="https://developer.apple.com/videos/play/wwdc2024/10137/">What’s new in SwiftData</a></h1>

<p><a href="https://developer.apple.com/videos/play/wwdc2024/10138">Create a custom data store with SwiftData</a></p>

<p><a href="https://developer.apple.com/videos/play/wwdc2024/10075">Track model changes with SwiftData history</a></p>

<p>Combining Core Data’s proven persistence technology and Swift’s modern concurrency features, SwiftData enables you to add persistence to your app quickly, with minimal code and no external dependencies. Using modern language features like macros, SwiftData enables you to write code that is fast, efficient, and safe, enabling you to describe the entire model layer (or object graph) for your app. The framework handles storing the underlying model data, and optionally, syncing that data across multiple devices.</p>

<p><img src="/assets/images/iOS_18/swift_data_api.png" alt="" /></p>
<h1 id="whats-new-in-swiftui"><a href="https://developer.apple.com/videos/play/wwdc2024/10144/">What’s new in SwiftUI</a></h1>
<ul>
  <li><a href="https://developer.apple.com/videos/play/wwdc2024/10150/?time=786">SwiftUI essentials</a></li>
  <li><a href="https://developer.apple.com/documentation/Updates/SwiftUI">SwiftUI updates</a></li>
</ul>

<h1 id="whats-new-in-xcode-16">What’s new in Xcode 16</h1>
<p><strong>Support breakpoint resumption when downloading various Components.</strong></p>

<p align="left"> 
<img src="/assets/images/iOS_18/xcode_16_1.png" width="320" />
<img src="/assets/images/iOS_18/xcode_16_2.png" width="320" />
</p>

<p><strong>Added Other Components of Predictive Code Completion Model, which is mainly used for code prediction function</strong></p>

<p><img src="/assets/images/iOS_18/xcode_16_3.png" alt="" /></p>

<p><strong>Added Swift Testing</strong></p>

<p align="left"> 
<img src="/assets/images/iOS_18/xcode_16_4.png" width="320" />
<img src="/assets/images/iOS_18/xcode_16_5.png" width="320" />
</p>

<p><strong>Project navigator New File/Template menu</strong></p>

<p><code class="language-plaintext highlighter-rouge">New File </code>–&gt; <code class="language-plaintext highlighter-rouge">New Empty File</code> : The original functions are retained
<code class="language-plaintext highlighter-rouge">New File from Template...</code>: Swift source files can be created quickly</p>
<p align="left"> 
<img src="/assets/images/iOS_18/xcode_16_6.png" width="320" />
<img src="/assets/images/iOS_18/xcode_16_7.png" width="320" />
</p>

<p><strong>Asset management</strong></p>

<p><img src="/assets/images/iOS_18/xcode_16_8.png" alt="" /></p>
<p align="left"> 
<img src="/assets/images/iOS_18/xcode_16_9.png" width="320" />
<img src="/assets/images/iOS_18/vedio/xcode_icon.gif" width="320" />
</p>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2024-06-20T00:00:00+08:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
</footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/2024/05/20/SwiftUI-Study.html">SwiftUI 学习笔记</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dylan"><meta itemprop="url" content="/"><meta itemprop="description" content="I am an amazing person."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:Leonsongfeng@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Dylan's Notes 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal d-print-none js-page-gallery-modal"><div class="gallery"></div></div><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
(function() {(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function swiper(options) {
      var $window = $(window), $root = this, $swiperWrapper, $swiperSlides, $swiperButtonPrev, $swiperButtonNext,
        initialSlide, animation, onChange, onChangeEnd,
        rootWidth, count, preIndex, curIndex, translateX, CRITICAL_ANGLE = Math.PI / 3;

      function setOptions(options) {
        var _options = options || {};
        initialSlide = _options.initialSlide || 0;
        animation = _options.animation === undefined && true;
        onChange = onChange || _options.onChange;
        onChangeEnd = onChangeEnd || _options.onChangeEnd;
      }

      function init() {
        $swiperWrapper = $root.find('.swiper__wrapper');
        $swiperSlides = $root.find('.swiper__slide');
        $swiperButtonPrev = $root.find('.swiper__button--prev');
        $swiperButtonNext = $root.find('.swiper__button--next');
        animation && $swiperWrapper.addClass('swiper__wrapper--animation');
        calc(true);
      }

      function preCalc() {
        rootWidth = $root.width();
        count = $swiperWrapper.children('.swiper__slide').length;
        if (count < 2) {
          $swiperButtonPrev.addClass('d-none');
          $swiperButtonNext.addClass('d-none');
        }
        curIndex = initialSlide || 0;
        translateX = getTranslateXFromCurIndex();
      }

      var calc = (function() {
        var preAnimation, $swiperSlide, $preSwiperSlide;
        return function (needPreCalc, params) {
          needPreCalc && preCalc();
          var _animation = (params && params.animation !== undefined) ? params.animation : animation;
          if (preAnimation === undefined || preAnimation !== _animation) {
            preAnimation = _animation ? $swiperWrapper.addClass('swiper__wrapper--animation') :
              $swiperWrapper.removeClass('swiper__wrapper--animation');
          }
          if (preIndex !== curIndex) {
            ($preSwiperSlide = $swiperSlides.eq(preIndex)).removeClass('active');
            ($swiperSlide = $swiperSlides.eq(curIndex)).addClass('active');
            onChange && onChange(curIndex, $swiperSlides.eq(curIndex), $swiperSlide, $preSwiperSlide);
            if (onChangeEnd) {
              if (_animation) {
                setTimeout(function() {
                  onChangeEnd(curIndex, $swiperSlides.eq(curIndex), $swiperSlide, $preSwiperSlide);
                }, 400);
              } else {
                onChangeEnd(curIndex, $swiperSlides.eq(curIndex), $swiperSlide, $preSwiperSlide);
              }
            }
            preIndex = curIndex;
          }
          $swiperWrapper.css('transform', 'translate(' + translateX + 'px, 0)');
          if (count > 1) {
            if (curIndex <= 0) {
              $swiperButtonPrev.addClass('disabled');
            } else {
              $swiperButtonPrev.removeClass('disabled');
            }
            if (curIndex >= count - 1) {
              $swiperButtonNext.addClass('disabled');
            } else {
              $swiperButtonNext.removeClass('disabled');
            }
          }
        };
      })();

      function getTranslateXFromCurIndex() {
        return curIndex <= 0 ? 0 : - rootWidth * curIndex;
      }

      function moveToIndex(index ,params) {
        preIndex = curIndex;
        curIndex = index;
        translateX = getTranslateXFromCurIndex();
        calc(false, params);
      }

      function move(type) {
        var nextIndex = curIndex, unstableTranslateX;
        if (type === 'prev') {
          nextIndex > 0 && nextIndex--;
        } else if (type === 'next') {
          nextIndex < count - 1 && nextIndex++;
        }
        if (type === 'cur') {
          moveToIndex(curIndex, { animation: true });
          return;
        }
        unstableTranslateX = translateX % rootWidth !== 0;
        if (nextIndex !== curIndex || unstableTranslateX) {
          unstableTranslateX ? moveToIndex(nextIndex, { animation: true }) : moveToIndex(nextIndex);
        }
      }

      setOptions(options);
      init();
      preIndex = curIndex;

      $swiperButtonPrev.on('click', function(e) {
        e.stopPropagation();
        move('prev');
      });
      $swiperButtonNext.on('click', function(e) {
        e.stopPropagation();
        move('next');
      });
      $window.on('resize', function() {
        calc(true, { animation: false });
      });

      (function() {
        var pageX, pageY, velocityX, preTranslateX = translateX, timeStamp, touching;
        function handleTouchstart(e) {
          var point = e.touches ? e.touches[0] : e;
          pageX = point.pageX;
          pageY = point.pageY;
          velocityX = 0;
          preTranslateX = translateX;
        }
        function handleTouchmove(e) {
          if (e.touches && e.touches.length > 1) {
            return;
          }
          var point = e.touches ? e.touches[0] : e;
          var deltaX = point.pageX - pageX;
          var deltaY = point.pageY - pageY;
          velocityX = deltaX / (e.timeStamp - timeStamp);
          timeStamp = e.timeStamp;
          if (e.cancelable && Math.abs(Math.atan(deltaY / deltaX)) < CRITICAL_ANGLE) {
            touching = true;
            translateX += deltaX;
            calc(false, { animation: false });
          }
          pageX = point.pageX;
          pageY = point.pageY;
        }
        function handleTouchend() {
          touching = false;
          var deltaX = translateX - preTranslateX;
          var distance = deltaX + velocityX * rootWidth;
          if (Math.abs(distance) > rootWidth / 2) {
            distance > 0 ? move('prev') : move('next');
          } else {
            move('cur');
          }
        }
        $swiperWrapper.on('touchstart', handleTouchstart);
        $swiperWrapper.on('touchmove', handleTouchmove);
        $swiperWrapper.on('touchend', handleTouchend);
        $swiperWrapper.on('touchcancel', handleTouchend);

        (function() {
          var pressing = false, moved = false;
          $swiperWrapper.on('mousedown', function(e) {
            pressing = true; handleTouchstart(e);
          });
          $swiperWrapper.on('mousemove', function(e) {
            pressing && (e.preventDefault(), moved = true, handleTouchmove(e));
          });
          $swiperWrapper.on('mouseup', function(e) {
            pressing && (pressing = false, handleTouchend(e));
          });
          $swiperWrapper.on('mouseleave', function(e) {
            pressing && (pressing = false, handleTouchend(e));
          });
          $swiperWrapper.on('click', function(e) {
            moved && (e.stopPropagation(), moved = false);
          });
        })();

        $root.on('touchmove', function(e) {
          if (e.cancelable & touching) {
            e.preventDefault();
          }
        });
      })();

      return {
        setOptions: setOptions,
        previous: function(){
          move('prev');
        },
        next: function(){
          move('next');
        },
        refresh: function() {
          calc(true, { animation: false });
        }
      };
    }
    $.fn.swiper = swiper;
  });
})();
var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var template =
      '<div class="swiper gallery__swiper">' +
        '<div class="swiper__wrapper">' +
        '</div>' +
        '<div class="swiper__button swiper__button--prev fas fa-chevron-left"></div>' +
        '<div class="swiper__button swiper__button--next fas fa-chevron-right"></div>' +
      '</div>';
    function setState($item, zoom, translate) {
      $item.css('transform', 'scale(' + zoom + ') translate(' + translate.x +  'px,' + translate.y + 'px)');
    }
    function Gallery(root, items) {
      this.$root = $(root);
      this.$swiper = null;
      this.$swiperWrapper = null;
      this.$activeItem = null;
      this.$items = [];
      this.contentWidth = 0;
      this.contentHeight = 0;
      this.swiper = null;
      this.items = items;
      this.disabled = false;
      this.curIndex = 0;
      this.touchCenter = null;
      this.lastTouchCenter = null;
      this.zoomRect = null;
      this.lastZoomRect = null;
      this.lastTranslate = null;
      this.translate = null;
      this.lastZoom = 1;
      this.preZoom = 1;
      this.zoom = 1;
    }
    Gallery.prototype.init = function() {
      var i, item, items = this.items, size, self = this, touchstartFingerCount = 0;
      this.$root.append(template);
      this.$swiper = this.$root.find('.gallery__swiper');
      this.$swiperWrapper = this.$root.find('.swiper__wrapper');
      this.contentWidth = this.$swiperWrapper && this.$swiperWrapper.width();
      this.contentHeight = this.$swiperWrapper && this.$swiperWrapper.height();
      for (i = 0; i < items.length; i++) {
        item = items[i];
        size = this._calculateImageSize(item.w, item.h);
        this.$items.push($(
          '<div class="swiper__slide">' +
            '<div class="gallery-item">' +
              '<div class="gallery-item__content">' +
                '<img src="' + item.src + '" style="width:' + size.w + 'px;height:' + size.h +  'px"/>' +
              '</div>' +
            '</div>' +
          '</div>'
        ));
      }
      this.$swiperWrapper && this.$swiperWrapper.append(this.$items);
      this.swiper = this.$swiper && this.$swiper.swiper({
        onChangeEnd: function() {
          self._handleChangeEnd.apply(self, Array.prototype.slice.call(arguments));
        }
      });
      $(window).on('resize', function() {
        if (self.disabled) { return; }
        self._resizeImageSize();
      });
      // Char Code: 37  ⬅, 39  ➡
      $(window).on('keyup', function(e) {
        if (window.isFormElement(e.target || e.srcElement) || self.disabled) { return; }
        if (e.which === 37) {
          self.swiper && self.swiper.previous();
        } else if (e.which === 39) {
          self.swiper && self.swiper.next();
        }
      });
      function getRect(touch0, touch1) {
        return {
          o: {
            x: (touch0.pageX + touch1.pageX) / 2,
            y: (touch0.pageY + touch1.pageY) / 2
          },
          w: Math.abs(touch0.pageX - touch1.pageX),
          h: Math.abs(touch0.pageY - touch1.pageY)
        };
      }
      function getTouches(e) {
        return e.touches || e;
      }
      function getTouchesCount(e) {
        if (e.touches) {
          return e.touches.length;
        } else {
          return 1;
        }
      }
      this.$swiperWrapper.on('touchstart', function(e) {
        var touch0, touch1, rect;
        touchstartFingerCount = getTouchesCount(e);
        if (touchstartFingerCount > 1) {
          touch0 = e.touches[0];
          touch1 = e.touches[1];
          rect = getRect(touch0, touch1);
          self.lastZoomRect = { w: rect.w, h: rect.h };
          self.lastTouchCenter = rect.o;
        } else {
          var touch = getTouches(e)[0];
          self.lastTouchCenter = { x: touch.pageX, y: touch.pageY };
        }
      });
      this.$swiperWrapper.on('touchmove', function(e) {
        if (touchstartFingerCount === getTouchesCount(e)) {
          if (touchstartFingerCount > 1) {
            var touch0 = e.touches[0];
            var touch1 = e.touches[1];
            var rect = getRect(touch0, touch1);
            self.zoomRect = { w: rect.w, h: rect.h };
            self.touchCenter = rect.o;
            self._zoom(); self._translate();
            setState(self.$activeItem, self.zoom, self.translate);
          } else {
            var touch = getTouches(e)[0];
            self.touchCenter = { x: touch.pageX, y: touch.pageY };
            self._translate();
            setState(self.$activeItem, self.zoom, self.translate);
          }
        }
      });
      this.$swiperWrapper.on('touchend', function(e) {
        self.lastZoom = self.zoom;
        self.lastTranslate = self.translate;
        touchstartFingerCount = 0;
      });
      this.$root.on('touchmove', function(e) {
        if (self.disabled) { return; }
        e.preventDefault();
      });
    };

    Gallery.prototype._translate = function() {
      this.translate = this.touchCenter && this.lastTouchCenter && this.lastTranslate ? {
        x: (this.touchCenter.x - this.lastTouchCenter.x) / this.zoom + this.lastTranslate.x,
        y: (this.touchCenter.y - this.lastTouchCenter.y) / this.zoom + this.lastTranslate.y
      } : { x: 0, y: 0 };
    }
    Gallery.prototype._zoom = function() {
      this.zoom = (this.zoomRect.w + this.zoomRect.h) / (this.lastZoomRect.w + this.lastZoomRect.h) * this.lastZoom;
      this.zoom > 1 ? this.$activeItem.addClass('zoom') : this.$activeItem.removeClass('zoom');
      this.preZoom = this.zoom;
    }

    Gallery.prototype._calculateImageSize = function(w, h) {
      var scale = 1;
      if (this.contentWidth > 0 && this.contentHeight > 0 && w > 0 && h > 0) {
        scale = Math.min(
          Math.min(w, this.contentWidth) / w,
          Math.min(h, this.contentHeight) / h);
      }
      return { w: Math.floor(w * scale), h: Math.floor(h * scale) };
    };

    Gallery.prototype._resizeImageSize = function() {
      var i, $item, $items = this.$items, item, size;
      this.contentWidth = this.$swiperWrapper && this.$swiperWrapper.width();
      this.contentHeight = this.$swiperWrapper && this.$swiperWrapper.height();
      if ($items.length < 1) { return; }
      for (i = 0; i < $items.length; i++) {
        item = this.items[i], $item = $items[i];
        size = this._calculateImageSize(item.w, item.h);
        item.width = size.w; item.height = size.h;
        $item && $item.find('img').css({ width: size.w, height: size.h });
      }
    };
    Gallery.prototype._handleChangeEnd = function(index, $dom, preIndex, $preDom) {
      this.curIndex = index;
      this.lastZoomRect = null; this.lastZoomRect = null;
      this.lastTranslate = this.translate = { x: 0, y:0 };
      this.lastZoom = this.preZoom = this.zoom = 1;
      this.$activeItem = $dom.find('.gallery-item__content');
      setState($preDom.find('.gallery-item__content'), this.zoom, this.translate);
    };

    Gallery.prototype.refresh = function() {
      this.swiper && this.swiper.refresh();
      this._resizeImageSize();
    };
    Gallery.prototype.setOptions = function(options) {
      this.disabled = options.disabled;
      this.swiper && this.swiper.setOptions(options);
    };
    window.Gallery = Gallery;
  });
})();(function() {
  window.imagesLoad = function(images) {
    images = images || document.getElementsByTagName('img');
    var imagesCount = images.length, loadedCount = 0, image;
    var i, j, loaded = false, cbs = [];
    imagesCount < 1 && (loaded = true);
    for (i = 0; i < imagesCount; i++) {
      image = images[i];
      image.complete ? handleImageLoad() : image.addEventListener('load', handleImageLoad);
    }
    function handleImageLoad() {
      loadedCount++;
      if (loadedCount === imagesCount) {
        loaded = true;
        if (cbs.length > 0) {
          for (j = 0; j < cbs.length; j++) {
            cbs[j]();
          }
        }
      }
    }
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  };
})();
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $pageGalleryModal = $('.js-page-gallery-modal');
    var $images = $('.page__content').find('img:not(.lightbox-ignore)');
    window.imagesLoad($images).then(function() {
      /* global Gallery */
      var pageGalleryModal = $pageGalleryModal.modal({ onChange: handleModalChange });
      var gallery = null;
      var modalVisible = false;
      var i, items = [], image, item;
      if($images && $images.length > 0) {
        for (i = 0; i < $images.length; i++) {
          image = $images.eq(i);
          if (image.get(0).naturalWidth > 800) {
            items.push({ src: image.attr('src'), w: image.get(0).naturalWidth, h: image.get(0).naturalHeight, $el: image});
          }
        }
      }

      if(items.length > 0) {
        gallery = new Gallery('.gallery', items);
        gallery.setOptions({ disabled: !modalVisible });
        gallery.init();
        for (i = 0; i < items.length; i++) {
          item = items[i];
          item.$el && (item.$el.addClass('popup-image'), item.$el.on('click', (function() {
            var index = i;
            return function() {
              pageGalleryModal.show();
              gallery.setOptions({ initialSlide: index });
              gallery.refresh(true, { animation: false });
            };
          })()));
        }
      }

      function handleModalChange(visible) {
        modalVisible = visible;
        gallery && gallery.setOptions({ disabled: !modalVisible });
      }

      $pageGalleryModal.on('click', function() {
        pageGalleryModal.hide();
      });
    });
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

